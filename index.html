<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://stackedit.io/style.css" />
    <link href="style.css" rel="stylesheet">
</head>

<body class="odd">
    <div id="preloader">
        <div id='square'></div>
        <div id='loader'>
            <h3>Great things take time</h3>Loading...
            <br>
            <span id="loaded">0</span>%
        </div>
    </div>
    
    <nav class="navbar navbar-expand-lg nbcl">
        <a class="navbar-brand" href="#landing">AYUSHYA SHAH</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link" href="../#landing">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../#services">Services</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../#customer">Why me?</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../#about-me">About me</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../#projects">Projects</a>
              </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <a href="../#contact-sm" class="btn btn-black my-2 my-sm-0" type="submit">Let's connect</a>
          </form>
        </div>
      </nav>
    
    <div id="spacing"></div>
    <img src="banner.png" style="width: 100%;margin-top:4px;">
    <div class="container" id="search-container">
        <div class="row">
            <div class="col-md-12">
                <div id="search">
                    <div class="row">
                        <div class="col-12">
                            &#x1F50D;&nbsp;<input id="searchbar" onkeyup="search_animal()" type="text" name="search" placeholder="Search..">

                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
    <div class="container" id="hi">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <div id="myc"><br><br>
                    <div id="reader"></div></div>
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>
    <div class="container" id="paintable"></div><br>

    <footer style="text-align: center;">
        <hr><br>
        Blog written with ü§ç by Ayushya Shah<br><br>
    </footer>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" ></script>
    <script>
        function findGetParameter(parameterName) {
            var result = null,
                tmp = [];
            var items = location.search.substr(1).split("&");
            for (var index = 0; index < items.length; index++) {
                tmp = items[index].split("=");
                if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
            }
            return result;
        }

        function search_animal() {
    let input = document.querySelector('#searchbar').value
    input = input.toLowerCase();
    let x = document.getElementsByClassName('blog_content');
    for (i = 0; i < x.length; i++) {
      if (!x[i].innerHTML.toLowerCase().includes(input)) {
        x[i].style.display = "none";
      }
      else {
        x[i].style.display = "block";
      }
    }
  }

        function hideloader() {
            if (document.readyState === 'ready' || document.readyState === 'complete') {
                var imagesLoaded = 0;
                var totalImages = $("img").length - 1;
                $("img").on("load", function (event) {
                    imagesLoaded++;
                    document.getElementById('loaded').innerText = String(((imagesLoaded / totalImages) * 100).toFixed(2));
                    if (imagesLoaded == totalImages) {
                        document.querySelector('#preloader').style.display = 'none';
                    }
                });
            } else {
                document.onreadystatechange = function () {
                    if (document.readyState == "complete") {
                        var imagesLoaded = 0;
                        var totalImages = $("img").length;
                        $("img").on("load", function (event) {
                            imagesLoaded++;
                            if (imagesLoaded == totalImages) {
                                document.querySelector('#preloader').style.display = 'none';
                            }
                        });
                    }
                }
            }
        }

        function painter(data) {
            var titles = [];
            var ids = [];
            var src = [];
            var summary = [];
            var published = [];
            data = data['feed']
            console.log(data)
            if ("entry" in data) {
                var d = data.entry.length;
                numberfeed = d;
                ii = 0;
                for (var h = 0; h < d; h++) {
                    var m = data.entry[h];
                    console.log(m)
                    var e = m.title.$t;
                    var s = m.summary.$t;
                    var li = m.media$thumbnail.url;
                    var p = m.published.$t.substring(8,10) + '-' + m.published.$t.substring(5,7) + '-' + m.published.$t.substring(0,4);
                    li = li.replace("s72-", "")
                    li = li.replace("/c/", "/s6912/")
                    var k = m.id.$t;
                    k = k.slice(k.lastIndexOf('-') + 1)
                    titles.push(e);
                    ids.push(k)
                    s += '....'
                    src.push(li)
                    summary.push(s)
                    published.push(p)
                }
            }
            console.log(titles)
            console.log(ids)
            tobe = ''
            alt = 0
            for (var i = 0; i < titles.length; i++) {
                tobe += '<div class="blog_content"><a href ="?blog=' + ids[i] + '"><div class="card"><div class="row g-0 align-middle align-items-center"> '
                if (alt == 0) {
                    alt = 1
                    tobe += '<div class="col-md-5"><img src="' + src[i] + '" class="img-fluid" alt="' + titles[i] + '"></div>';
                    tobe += '<div class="col-md-1"></div>'
                    tobe += '<div class="col-md-6"><div class="card-body"><h5 class="card-title">' + titles[i] + '</h5><p class="card-text">' + summary[i] + '</p><p class="card-text"><small class="text-muted"> Published on '+published[i]+'</small></p></div></div>'
                }
                else {
                    alt = 0
                    tobe += '<div class="col-md-5 order-md-3"><img src="' + src[i] + '" class="img-fluid" alt="' + titles[i] + '"></div>';
                    tobe += '<div class = "col-md-1 order-md-2"></div>'
                    tobe += '<div class="col-md-6 order-md-1"><div class="card-body"><h5 class="card-title">' + titles[i] + '</h5><p class="card-text">' + summary[i] + '</p><p class="card-text"><small class="text-muted"> Published on '+published[i]+'</small></p></div></div>'

                }
                tobe += '</div></div></a><hr></div>'
            }

            tobe = tobe.slice(0, -10);
            tobe += '</div>'
            document.querySelector('#paintable').innerHTML = tobe
        }

        var isnum = 0
        theparameter = findGetParameter('blog')
        try {
            Number(theparameter)
        } catch (error) {
            n = 1
        }

        if (theparameter && isnum == 0) {
            url = 'https://personal-emailer.vercel.app/post/' + String(theparameter)
            $.ajax({
                url: url,
                crossDomain: true,
                method: 'GET',
                dataType: false,
                success: function (data) {
                    if (data == 'Internal Error') {
                        window.location.href = window.location.pathname;
                    }
                    else {
                        document.getElementById('reader').innerHTML = (data['entry']['content']['$t']);
                        // document.getElementById('b_title').innerHTML = (data['entry']['title']['$t']);
                        document.getElementById('paintable').style.display = 'none';
                        document.getElementById('search-container').style.display = 'none';

                        hideloader()
                    }
                },
                error: function (a) {
                }
            });
        }
        else {
            document.getElementById('hi').style.display = 'none'
            url = 'https://personal-emailer.vercel.app/all'
            $.ajax({
                url: url,
                crossDomain: true,
                method: 'GET',
                dataType: false,
                success: function (data) {
                    painter(data)
                    hideloader();
                },
                error: function (a) {
                    console.log('kk')
                    console.log(a);
                }
            });
        }









    </script>
</body>

</html>